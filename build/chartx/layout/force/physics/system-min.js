define("chartx/layout/force/physics/system",["chartx/layout/force/kernel","chartx/layout/force/physics/atoms"],function(a,b){var c=function(c,d,e,f,g,h,i,j){var k=[],l=null,m=0,n=null,o=.04,p=[20,20,20,20],q=null,r=null;if("object"==typeof c){var s=c;e=s.friction,c=s.repulsion,g=s.fps,h=s.dt,d=s.stiffness,f=s.gravity,i=s.precision,j=s.integrator}"verlet"!=j&&"euler"!=j&&(j="verlet"),e=isNaN(e)?.5:e,c=isNaN(c)?1e3:c,g=isNaN(g)?55:g,d=isNaN(d)?600:d,h=isNaN(h)?.02:h,i=isNaN(i)?.6:i,f=f===!0;var t,u=void 0!==g?1e3/g:20,v={integrator:j,repulsion:c,stiffness:d,friction:e,dt:h,gravity:f,precision:i,timeout:u},w={renderer:null,tween:null,nodes:{},edges:{},adjacency:{},names:{},kernel:null},x={parameters:function(a){return void 0!==a&&(isNaN(a.precision)||(a.precision=Math.max(0,Math.min(1,a.precision))),_.each(v,function(b,c){void 0!==a[c]&&(v[c]=a[c])}),w.kernel.physicsModified(a)),v},fps:function(a){return void 0===a?w.kernel.fps():void x.parameters({timeout:1e3/(a||50)})},start:function(){w.kernel.start()},stop:function(){w.kernel.stop()},addNode:function(a,c){c=c||{};var d=w.names[a];if(d)return d.data=c,d;if(void 0!=a){var e=void 0!=c.x?c.x:null,f=void 0!=c.y?c.y:null,g=c.fixed?1:0,h=new b.Node(c);return h.name=a,w.names[a]=h,w.nodes[h._id]=h,k.push({t:"addNode",id:h._id,m:h.mass,x:e,y:f,f:g}),x._notify(),h}},pruneNode:function(a){var b=x.getNode(a);"undefined"!=typeof w.nodes[b._id]&&(delete w.nodes[b._id],delete w.names[b.name]),_.each(w.edges,function(a,c){(a.source._id===b._id||a.target._id===b._id)&&x.pruneEdge(a)}),k.push({t:"dropNode",id:b._id}),x._notify()},getNode:function(a){return void 0!==a._id?a:"string"==typeof a||"number"==typeof a?w.names[a]:void 0},eachNode:function(a){_.each(w.nodes,function(b,c){if(null!=b._p.x&&null!=b._p.y){var d=null!==n?x.toScreen(b._p):b._p;a.call(x,b,d)}})},addEdge:function(a,c,d){a=x.getNode(a)||x.addNode(a),c=x.getNode(c)||x.addNode(c),d=d||{};var e=new b.Edge(a,c,d),f=a._id,g=c._id;w.adjacency[f]=w.adjacency[f]||{},w.adjacency[f][g]=w.adjacency[f][g]||[];var h=w.adjacency[f][g].length>0;if(h)return void $.extend(w.adjacency[f][g].data,e.data);w.edges[e._id]=e,w.adjacency[f][g].push(e);var i=void 0!==e.length?e.length:1;return k.push({t:"addSpring",id:e._id,fm:f,to:g,l:i}),x._notify(),e},pruneEdge:function(a){k.push({t:"dropSpring",id:a._id}),delete w.edges[a._id];for(var b in w.adjacency)for(var c in w.adjacency[b])for(var d=w.adjacency[b][c],e=d.length-1;e>=0;e--)w.adjacency[b][c][e]._id===a._id&&w.adjacency[b][c].splice(e,1);x._notify()},getEdges:function(a,b){return a=x.getNode(a),b=x.getNode(b),a&&b&&"undefined"!=typeof w.adjacency[a._id]&&"undefined"!=typeof w.adjacency[a._id][b._id]?w.adjacency[a._id][b._id]:[]},getEdgesFrom:function(a){if(a=x.getNode(a),!a)return[];if("undefined"!=typeof w.adjacency[a._id]){var b=[];return _.each(w.adjacency[a._id],function(a,c){b=b.concat(a)}),b}return[]},getEdgesTo:function(a){if(a=x.getNode(a),!a)return[];var b=[];return _.each(w.edges,function(c,d){c.target==a&&b.push(c)}),b},eachEdge:function(a){_.each(w.edges,function(b,c){var d=w.nodes[b.source._id]._p,e=w.nodes[b.target._id]._p;null!=d.x&&null!=e.x&&(d=null!==n?x.toScreen(d):d,e=null!==n?x.toScreen(e):e,d&&e&&a.call(x,b,d,e))})},prune:function(a){var b={dropped:{nodes:[],edges:[]}};return void 0===a?_.each(w.nodes,function(a,c){b.dropped.nodes.push(a),x.pruneNode(a)}):x.eachNode(function(c){var d=a.call(x,c,{from:x.getEdgesFrom(c),to:x.getEdgesTo(c)});d&&(b.dropped.nodes.push(c),x.pruneNode(c))}),b},graft:function(a){var b={added:{nodes:[],edges:[]}};return a.nodes&&(_.each(a.nodes,function(a,c){var d=x.getNode(c);d?d.data=a:b.added.nodes.push(x.addNode(c,a))}),a.nodes.length>0&&w.kernel.start()),a.edges&&_.each(a.edges,function(a,c){var d=x.getNode(c);d||b.added.nodes.push(x.addNode(c,{})),_.each(a,function(a,d){var e=x.getNode(d);e||b.added.nodes.push(x.addNode(d,{}));var f=x.getEdges(c,d);f.length>0?f[0].data=a:b.added.edges.push(x.addEdge(c,d,a))})}),b},merge:function(a){var b={added:{nodes:[],edges:[]},dropped:{nodes:[],edges:[]}};_.each(w.edges,function(c,d){(void 0===a.edges[c.source.name]||void 0===a.edges[c.source.name][c.target.name])&&(x.pruneEdge(c),b.dropped.edges.push(c))});var c=x.prune(function(c,d){return void 0===a.nodes[c.name]?(b.dropped.nodes.push(c),!0):void 0}),d=x.graft(a);return b.added.nodes=b.added.nodes.concat(d.added.nodes),b.added.edges=b.added.edges.concat(d.added.edges),b.dropped.nodes=b.dropped.nodes.concat(c.dropped.nodes),b.dropped.edges=b.dropped.edges.concat(c.dropped.edges),b},tweenNode:function(a,b,c){var d=x.getNode(a);d&&w.tween.to(d,b,c)},tweenEdge:function(a,b,c,d){if(void 0===d)x._tweenEdge(a,b,c);else{var e=x.getEdges(a,b);_.each(e,function(a,b){x._tweenEdge(a,c,d)})}},_tweenEdge:function(a,b,c){a&&void 0!==a._id&&w.tween.to(a,b,c)},_updateGeometry:function(a){if(void 0!=a){var b=a.epoch<m;t=a.energy;var c=a.geometry;if(void 0!==c)for(var d=0,e=c.length/3;e>d;d++){var f=c[3*d];b&&void 0==w.nodes[f]||(w.nodes[f]._p.x=c[3*d+1],w.nodes[f]._p.y=c[3*d+2])}}},screen:function(a){return void 0==a?{size:n?objcopy(n):void 0,padding:p.concat(),step:o}:(void 0!==a.size&&x.screenSize(a.size.width,a.size.height),isNaN(a.step)||x.screenStep(a.step),void(void 0!==a.padding&&x.screenPadding(a.padding)))},screenSize:function(a,b){n={width:a,height:b},x._updateBounds()},screenPadding:function(a,b,c,d){_.isArray(a)?trbl=a:trbl=[a,b,c,d];var e=trbl[0],f=trbl[1],g=trbl[2];void 0===f?trbl=[e,e,e,e]:void 0==g&&(trbl=[e,f,e,f]),p=trbl},screenStep:function(a){o=a},toScreen:function(a){if(q&&n){var c=p||[0,0,0,0],d=q.bottomright.subtract(q.topleft),e=c[3]+a.subtract(q.topleft).divide(d.x).x*(n.width-(c[1]+c[3])),f=c[0]+a.subtract(q.topleft).divide(d.y).y*(n.height-(c[0]+c[2]));return new b.Point(e,f)}},fromScreen:function(a){if(q&&n){var c=p||[0,0,0,0],d=q.bottomright.subtract(q.topleft),e=(a.x-c[3])/(n.width-(c[1]+c[3]))*d.x+q.topleft.x,f=(a.y-c[0])/(n.height-(c[0]+c[2]))*d.y+q.topleft.y;return new b.Point(e,f)}},_updateBounds:function(a){if(null!==n){r=a?a:x.bounds();var c=new b.Point(r.bottomright.x,r.bottomright.y),d=new b.Point(r.topleft.x,r.topleft.y),e=c.subtract(d),f=d.add(e.divide(2)),g=4,h=new b.Point(Math.max(e.x,g),Math.max(e.y,g));if(r.topleft=f.subtract(h.divide(2)),r.bottomright=f.add(h.divide(2)),!q)return _.isEmpty(w.nodes)?!1:(q=r,!0);var i=o;_newBounds={bottomright:q.bottomright.add(r.bottomright.subtract(q.bottomright).multiply(i)),topleft:q.topleft.add(r.topleft.subtract(q.topleft).multiply(i))};var j=new b.Point(q.topleft.subtract(_newBounds.topleft).magnitude(),q.bottomright.subtract(_newBounds.bottomright).magnitude());return j.x*n.width>1||j.y*n.height>1?(q=_newBounds,!0):!1}},energy:function(){return t},bounds:function(){var a=null,c=null;return _.each(w.nodes,function(d,e){if(!a)return a=new b.Point(d._p),void(c=new b.Point(d._p));var f=d._p;null!==f.x&&null!==f.y&&(f.x>a.x&&(a.x=f.x),f.y>a.y&&(a.y=f.y),f.x<c.x&&(c.x=f.x),f.y<c.y&&(c.y=f.y))}),a&&c?{bottomright:a,topleft:c}:{topleft:new b.Point(-1,-1),bottomright:new b.Point(1,1)}},nearest:function(a){null!==n&&(a=x.fromScreen(a));var b={node:null,point:null,distance:null};return _.each(w.nodes,function(c,d){var e=c._p;if(null!==e.x&&null!==e.y){var f=e.subtract(a).magnitude();(null===b.distance||f<b.distance)&&(b={node:c,point:e,distance:f},null!==n&&(b.screenPoint=x.toScreen(e)))}}),b.node?(null!==n&&(b.distance=x.toScreen(b.node.p).subtract(x.toScreen(a)).magnitude()),b):null},_notify:function(){null===l?m++:clearTimeout(l),l=setTimeout(x._synchronize,20)},_synchronize:function(){k.length>0&&(w.kernel.graphChanged(k),k=[],l=null)}};return w.kernel=a(x),w.tween=w.kernel.tween||null,b.Node.prototype.__defineGetter__("p",function(){var a=this,c={};return c.__defineGetter__("x",function(){return a._p.x}),c.__defineSetter__("x",function(b){w.kernel.particleModified(a._id,{x:b})}),c.__defineGetter__("y",function(){return a._p.y}),c.__defineSetter__("y",function(b){w.kernel.particleModified(a._id,{y:b})}),c.__proto__=b.Point.prototype,c}),b.Node.prototype.__defineSetter__("p",function(a){this._p.x=a.x,this._p.y=a.y,w.kernel.particleModified(this._id,{x:a.x,y:a.y})}),b.Node.prototype.__defineGetter__("mass",function(){return this._mass}),b.Node.prototype.__defineSetter__("mass",function(a){this._mass=a,w.kernel.particleModified(this._id,{m:a})}),b.Node.prototype.__defineSetter__("tempMass",function(a){w.kernel.particleModified(this._id,{_m:a})}),b.Node.prototype.__defineGetter__("fixed",function(){return this._fixed}),b.Node.prototype.__defineSetter__("fixed",function(a){this._fixed=a,w.kernel.particleModified(this._id,{f:a?1:0})}),x};return self.ParticleSystem=c,c});