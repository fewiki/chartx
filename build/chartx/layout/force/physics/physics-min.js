define("chartx/layout/force/physics/physics",["chartx/layout/force/physics/atoms","chartx/layout/force/physics/barnes-hut"],function(a,b){var c=function(c,d,e,f,g,h){!a&&self.Atoms&&(a=self.Atoms),!b&&self.BarnesHutTree&&(b=self.BarnesHutTree);var i=b(),j={particles:{},springs:{}},k={particles:{}},l=[],m=[],n=0,o={sum:0,max:0,mean:0},p={topleft:new a.Point(-1,-1),bottomright:new a.Point(1,1)},q=1e3,r={integrator:["verlet","euler"].indexOf(h)>=0?h:"verlet",stiffness:void 0!==d?d:1e3,repulsion:void 0!==e?e:600,friction:void 0!==f?f:.3,gravity:!1,dt:void 0!==c?c:.02,theta:.4,init:function(){return r},modifyPhysics:function(a){_.each(["stiffness","repulsion","friction","gravity","dt","precision","integrator"],function(b,c){if(void 0!==a[b]){if("precision"==b)return void(r.theta=1-a[b]);if(r[b]=a[b],"stiffness"==b){var d=a[b];_.each(j.springs,function(a,b){a.k=d})}}})},addNode:function(b){var c=b.id,d=b.m,e=p.bottomright.x-p.topleft.x,f=p.bottomright.y-p.topleft.y,g=new a.Point(null!=b.x?b.x:p.topleft.x+e*Math.random(),null!=b.y?b.y:p.topleft.y+f*Math.random());j.particles[c]=new a.Particle(g,d),j.particles[c].connections=0,j.particles[c].fixed=1===b.f,k.particles[c]=j.particles[c],l.push(j.particles[c])},dropNode:function(a){var b=a.id,c=j.particles[b],d=$.inArray(c,l);d>-1&&l.splice(d,1),delete j.particles[b],delete k.particles[b]},modifyNode:function(a,b){if(a in j.particles){var c=j.particles[a];"x"in b&&(c.p.x=b.x),"y"in b&&(c.p.y=b.y),"m"in b&&(c.m=b.m),"f"in b&&(c.fixed=1===b.f),"_m"in b&&(void 0===c._m&&(c._m=c.m),c.m=b._m)}},addSpring:function(b){var c=b.id,d=b.l,e=j.particles[b.fm],f=j.particles[b.to];void 0!==e&&void 0!==f&&(j.springs[c]=new a.Spring(e,f,d,r.stiffness),m.push(j.springs[c]),e.connections++,f.connections++,delete k.particles[b.fm],delete k.particles[b.to])},dropSpring:function(a){var b=a.id,c=j.springs[b];c.point1.connections--,c.point2.connections--;var d=$.inArray(c,m);d>-1&&m.splice(d,1),delete j.springs[b]},_update:function(a){return n++,_.each(a,function(a,b){a.t in r&&r[a.t](a)}),n},tick:function(){r.tendParticles(),"euler"==r.integrator?(r.updateForces(),r.updateVelocity(r.dt),r.updatePosition(r.dt)):(r.updateForces(),r.cacheForces(),r.updatePosition(r.dt),r.updateForces(),r.updateVelocity(r.dt)),r.tock()},tock:function(){var a=[];_.each(j.particles,function(b,c){a.push(c),a.push(b.p.x),a.push(b.p.y)}),g&&g({geometry:a,epoch:n,energy:o,bounds:p})},tendParticles:function(){_.each(j.particles,function(a,b){void 0!==a._m&&(Math.abs(a.m-a._m)<1?(a.m=a._m,delete a._m):a.m*=.98),a.v.x=a.v.y=0})},updateForces:function(){r.repulsion>0&&(r.theta>0?r.applyBarnesHutRepulsion():r.applyBruteForceRepulsion()),r.stiffness>0&&r.applySprings(),r.applyCenterDrift(),r.gravity&&r.applyCenterGravity()},cacheForces:function(){_.each(j.particles,function(a,b){a._F=a.f})},applyBruteForceRepulsion:function(){_.each(j.particles,function(b,c){_.each(j.particles,function(c,d){if(b!==c){var e=b.p.subtract(c.p),f=Math.max(1,e.magnitude()),g=(e.magnitude()>0?e:a.Point.random(1)).normalize();b.applyForce(g.multiply(r.repulsion*(c._m||c.m)*.5).divide(f*f*.5)),c.applyForce(g.multiply(r.repulsion*(b._m||b.m)*.5).divide(f*f*-.5))}})})},applyBarnesHutRepulsion:function(){if(p.topleft&&p.bottomright){var b=new a.Point(p.bottomright),c=new a.Point(p.topleft);i.init(c,b,r.theta),_.each(j.particles,function(a,b){i.insert(a)}),_.each(j.particles,function(a,b){i.applyForces(a,r.repulsion)})}},applySprings:function(){_.each(j.springs,function(b,c){var d=b.point2.p.subtract(b.point1.p),e=b.length-d.magnitude(),f=(d.magnitude()>0?d:a.Point.random(1)).normalize();b.point1.applyForce(f.multiply(b.k*e*-.5)),b.point2.applyForce(f.multiply(b.k*e*.5))})},applyCenterDrift:function(){var b=0,c=new a.Point(0,0);if(_.each(j.particles,function(a,d){c.add(a.p),b++}),0!=b){var d=c.divide(-b);_.each(j.particles,function(a,b){a.applyForce(d)})}},applyCenterGravity:function(){_.each(j.particles,function(a,b){var c=a.p.multiply(-1);a.applyForce(c.multiply(r.repulsion/100))})},updateVelocity:function(b){var c=0,d=0,e=0;_.each(j.particles,function(f,g){if(f.fixed)return f.v=new a.Point(0,0),void(f.f=new a.Point(0,0));"euler"==r.integrator?f.v=f.v.add(f.f.multiply(b)).multiply(1-r.friction):f.v=f.v.add(f.f.add(f._F.divide(f.m)).multiply(.5*b)).multiply(1-r.friction),f.f.x=f.f.y=0;var h=f.v.magnitude();h>q&&(f.v=f.v.divide(h*h));var h=f.v.magnitude(),i=h*h;c+=i,d=Math.max(i,d),e++}),o={sum:c,max:d,mean:c/e,n:e}},updatePosition:function(b){var c=null,d=null;_.each(j.particles,function(e,f){if("euler"==r.integrator)e.p=e.p.add(e.v.multiply(b));else{var g=e.f.multiply(.5*b*b).divide(e.m);e.p=e.p.add(e.v.multiply(b)).add(g)}if(!c)return c=new a.Point(e.p.x,e.p.y),void(d=new a.Point(e.p.x,e.p.y));var h=e.p;null!==h.x&&null!==h.y&&(h.x>c.x&&(c.x=h.x),h.y>c.y&&(c.y=h.y),h.x<d.x&&(d.x=h.x),h.y<d.y&&(d.y=h.y))}),p={topleft:d||new a.Point(-1,-1),bottomright:c||new a.Point(1,1)}},systemEnergy:function(a){return o}};return r.init()};return self.Physics=c,c});